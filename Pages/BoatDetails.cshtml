@page "{id:int}"
@model SaillingLoc.Pages.BoatDetailsModel

@using Microsoft.AspNetCore.Identity
@using SaillingLoc.Models
@inject SignInManager<User> SignInManager

@{
    ViewData["Title"] = "Détails du bateau";
    Layout = "_Layout";
}

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #f5f3ef;
        margin: 0;
        padding: 0;
    }

    .boat-details-container {
        max-width: 1400px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .boat-details-row {
        display: flex;
        gap: 30px;
        align-items: flex-start;
    }

    .boat-image-section {
        flex: 0 0 60%;
    }

    .main-image {
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 15px;
    }

    .main-image img {
        width: 100%;
        height: auto;
        display: block;
    }

    .thumbnail {
        width: 80px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
    }

    .thumbnail:hover {
        border-color: #a67c52;
    }

    .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .boat-info-section {
        flex: 0 0 35%;
        background-color: white;
        padding: 0;
    }

    .boat-title {
        font-size: 2rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .boat-subtitle {
        font-size: 0.95rem;
        color: #666;
        margin-bottom: 10px;
    }

    .boat-price {
        font-size: 1.3rem;
        color: #a67c52;
        font-weight: 600;
        margin-bottom: 25px;
    }

    .boat-details-list {
        margin-bottom: 30px;
    }

    .boat-details-list p {
        font-size: 0.95rem;
        color: #333;
        margin: 8px 0;
        line-height: 1.6;
    }

    .boat-details-list strong {
        color: #1a1a1a;
        font-weight: 600;
    }

    .rent-button {
        width: 100%;
        background-color: #a67c52;
        color: white;
        border: none;
        padding: 15px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
        text-align: center;
        text-decoration: none;
        display: block;
    }

    .rent-button:hover {
        background-color: #8f6a44;
    }

    .description-section {
        margin-top: 40px;
    }

    .description-section h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .description-section p {
        font-size: 0.95rem;
        color: #666;
        line-height: 1.6;
    }

    .equipements-section {
        margin-top: 40px;
    }

    .equipements-section h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
    }

    .equipements-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
    }

    .equipement-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        color: #333;
    }

    .equipement-item i {
        color: #5a7d9a;
        font-size: 1.1rem;
    }

    .add-equipment-form {
        margin-top: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
    }

    .add-equipment-form h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .form-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .form-group input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 0.95rem;
    }

    .form-group button {
        padding: 10px 20px;
        background-color: #5a7d9a;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .form-group button:hover {
        background-color: #4a6d8a;
    }

    .back-link {
        display: inline-block;
        margin-top: 30px;
        color: #a67c52;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
    }

    .back-link:hover {
        text-decoration: underline;
    }
</style>

<div class="boat-details-container">
    @if (Model.Boat != null)
    {
        <div class="boat-details-row">
            <!-- Section Image -->
            <div class="boat-image-section">
                <div class="main-image">
                    @if (Model.Boat.Photos != null && Model.Boat.Photos.Any())
                    {
                        <img src="@Model.Boat.Photos.First().PhotoUrl" alt="@Model.Boat.Name" id="mainImage" />
                    }
                    else if (!string.IsNullOrEmpty(Model.Boat.Photo))
                    {
                        <img src="@Model.Boat.Photo" alt="@Model.Boat.Name" id="mainImage" />
                    }
                </div>

                @if (Model.Boat.Photos != null && Model.Boat.Photos.Count > 1)
                {
                    <div style="display: flex; gap: 10px;">
                        @foreach (var photo in Model.Boat.Photos.Take(4))
                        {
                            <div class="thumbnail" onclick="changeImage('@photo.PhotoUrl')">
                                <img src="@photo.PhotoUrl" alt="Miniature" />
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Section Informations -->
            <div class="boat-info-section">
                <h1 class="boat-title">@Model.Boat.Name</h1>
                <p class="boat-subtitle">
                    @(Model.Boat.BoatType?.Name ?? "Sea Ray") • Oceani 40 • 10.48 m
                </p>
                <p class="boat-price">@Model.Boat.DailyPrice.ToString("F2") € / jour</p>

                <div class="boat-details-list">
                    <p><strong>Port :</strong> @(Model.Boat.Port?.Name ?? "Port de Brest")</p>
                    <p><strong>Type :</strong> @(Model.Boat.BoatType?.Name ?? "Yacht")</p>
                    <p><strong>Capacité :</strong> 12 personnes</p>
                    <p><strong>Moteur :</strong> Volco penta 40 CV</p>
                    <p><strong>Skipper requis :</strong> Non</p>
                </div>

                @* Bouton Louer maintenant avec redirection selon la connexion *@
                @if (SignInManager.IsSignedIn(User))
                {
                    <a asp-page="/ReserveBoat"
                       asp-route-id="@Model.Boat.Id"
                       asp-route-price="@Model.Boat.DailyPrice"
                       class="rent-button">
                        Louer maintenant
                    </a>
                }
                else
                {
                    <a asp-page="/Account/Login"
                       asp-route-returnUrl="@Url.Page("/ReserveBoat", new { id = Model.Boat.Id, price = Model.Boat.DailyPrice })"
                       class="rent-button">
                        Louer maintenant
                    </a>
                }
            </div>
        </div>

        <!-- Section Description -->
        <div class="description-section">
            <h2>Description</h2>
            <p>@(Model.Boat.Description ?? "Magnifique bateaux")</p>
        </div>

        <!-- Section Équipements -->
        <div class="equipements-section">
            <h2>Équipements</h2>
            <div class="equipements-grid">
                <!-- Équipements statiques -->
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Compas</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>GPS / traceur</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Barbecue</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Ancre principale</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Ventilateurs</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Kayak</span>
                </div>

                <!-- Équipements dynamiques ajoutés par le propriétaire ou l'admin -->
                @if (Model.Boat.Equipments != null && Model.Boat.Equipments.Any())
                {
                    @foreach (var equipment in Model.Boat.Equipments)
                    {
                        <div class="equipement-item">
                            <i class="fas fa-check-circle"></i>
                            <span>@equipment.EquipmentName</span>
                        </div>
                    }
                }
            </div>

            <!-- Formulaire d'ajout d'équipement (visible seulement pour le propriétaire ou l'admin) -->
            @if (Model.CanEditEquipment)
            {
                <div class="add-equipment-form">
                    <h3>Ajouter un équipement</h3>
                    <form method="post" asp-page-handler="AddEquipment" asp-route-id="@Model.Boat.Id">
                        <div class="form-group">
                            <input type="text" 
                                   asp-for="NewEquipmentName" 
                                   placeholder="Nom de l'équipement" 
                                   required />
                            <button type="submit">Ajouter</button>
                        </div>
                    </form>
                </div>
            }
        </div>

        <a asp-page="/Index" class="back-link">← Retour à la liste</a>
    }
    else
    {
        <p style="text-align: center; color: #e74c3c;">Bateau introuvable.</p>
        <a asp-page="/Index" class="back-link">← Retour à la liste</a>
    }
</div>

<script>
    function changeImage(url) {
        document.getElementById('mainImage').src = url;
    }
</script>


































































@* 
 @page "{id:int}"
@model SaillingLoc.Pages.BoatDetailsModel

@using Microsoft.AspNetCore.Identity
@using SaillingLoc.Models
@inject SignInManager<User> SignInManager

@{
    ViewData["Title"] = "Détails du bateau";
    Layout = "_Layout";
}

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #f5f3ef;
        margin: 0;
        padding: 0;
    }

    .boat-details-container {
        max-width: 1400px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .boat-details-row {
        display: flex;
        gap: 30px;
        align-items: flex-start;
    }

    .boat-image-section {
        flex: 0 0 60%;
    }

    .main-image {
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 15px;
    }

    .main-image img {
        width: 100%;
        height: auto;
        display: block;
    }

    .thumbnail {
        width: 80px;
        height: 60px;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid transparent;
    }

    .thumbnail:hover {
        border-color: #a67c52;
    }

    .thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .boat-info-section {
        flex: 0 0 35%;
        background-color: white;
        padding: 0;
    }

    .boat-title {
        font-size: 2rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .boat-subtitle {
        font-size: 0.95rem;
        color: #666;
        margin-bottom: 10px;
    }

    .boat-price {
        font-size: 1.3rem;
        color: #a67c52;
        font-weight: 600;
        margin-bottom: 25px;
    }

    .boat-details-list {
        margin-bottom: 30px;
    }

    .boat-details-list p {
        font-size: 0.95rem;
        color: #333;
        margin: 8px 0;
        line-height: 1.6;
    }

    .boat-details-list strong {
        color: #1a1a1a;
        font-weight: 600;
    }

    .rent-button {
        width: 100%;
        background-color: #a67c52;
        color: white;
        border: none;
        padding: 15px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .rent-button:hover {
        background-color: #8f6a44;
    }

    .description-section {
        margin-top: 40px;
    }

    .description-section h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 15px;
    }

    .description-section p {
        font-size: 0.95rem;
        color: #666;
        line-height: 1.6;
    }

    .equipements-section {
        margin-top: 40px;
    }

    .equipements-section h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 20px;
    }

    .equipements-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
    }

    .equipement-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
        color: #333;
    }

    .equipement-item i {
        color: #5a7d9a;
        font-size: 1.1rem;
    }

    .back-link {
        display: inline-block;
        margin-top: 30px;
        color: #a67c52;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
    }

    .back-link:hover {
        text-decoration: underline;
    }
</style>

<div class="boat-details-container">
    @if (Model.Boat != null)
    {
        <div class="boat-details-row">
            <!-- Section Image -->
            <div class="boat-image-section">
                <div class="main-image">
                    @if (Model.Boat.Photos != null && Model.Boat.Photos.Any())
                    {
                        <img src="@Model.Boat.Photos.First().PhotoUrl" alt="@Model.Boat.Name" id="mainImage" />
                    }
                    else if (!string.IsNullOrEmpty(Model.Boat.Photo))
                    {
                        <img src="@Model.Boat.Photo" alt="@Model.Boat.Name" id="mainImage" />
                    }
                </div>

                @if (Model.Boat.Photos != null && Model.Boat.Photos.Count > 1)
                {
                    <div style="display: flex; gap: 10px;">
                        @foreach (var photo in Model.Boat.Photos.Take(4))
                        {
                            <div class="thumbnail" onclick="changeImage('@photo.PhotoUrl')">
                                <img src="@photo.PhotoUrl" alt="Miniature" />
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Section Informations -->
            <div class="boat-info-section">
                <h1 class="boat-title">@Model.Boat.Name</h1>
                <p class="boat-subtitle">
                    @(Model.Boat.BoatType?.Name ?? "Sea Ray") • Oceani 40 • 10.48 m
                </p>
                <p class="boat-price">@Model.Boat.DailyPrice.ToString("F2") € / jour</p>

                <div class="boat-details-list">
                    <p><strong>Port :</strong> @(Model.Boat.Port?.Name ?? "Port de Brest")</p>
                    <p><strong>Type :</strong> @(Model.Boat.BoatType?.Name ?? "Yacht")</p>
                    <p><strong>Capacité :</strong> 12 personnes</p>
                    <p><strong>Moteur :</strong> Volco penta 40 CV</p>
                    <p><strong>Skipper requis :</strong> Non</p>
                </div>

                @* Bouton Louer maintenant avec redirection selon la connexion *@
                    @* @if (SignInManager.IsSignedIn(User))
{
    <a asp-page="/ReserveBoat"
       asp-route-id="@Model.Boat.Id"
       asp-route-price="@Model.Boat.DailyPrice"
       class="rent-button">
        Louer maintenant
    </a>
}
else
{
    <a asp-page="/Account/Login"
       asp-route-returnUrl="@Url.Page("/ReserveBoat", new { id = Model.Boat.Id, price = Model.Boat.DailyPrice })"
       class="rent-button">
        Louer maintenant
    </a>
}

            </div>
        </div>

        <!-- Section Description -->
        <div class="description-section">
            <h2>Description</h2>
            <p>@(Model.Boat.Description ?? "Magnifique bateaux")</p>
        </div>

        <!-- Section Équipements -->
        <div class="equipements-section">
            <h2>Équipements</h2>
            <div class="equipements-grid">
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Compas</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>GPS / traceur</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Barbecue</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Ancre principale</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Ventilateurs</span>
                </div>
                <div class="equipement-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Kayak</span>
                </div>
            </div>
        </div>

        <a asp-page="/Index" class="back-link">← Retour à la liste</a>
    }
    else
    {
        <p style="text-align: center; color: #e74c3c;">Bateau introuvable.</p>
        <a asp-page="/Index" class="back-link">← Retour à la liste</a>
    }
</div>

<script>
    function changeImage(url) {
        document.getElementById('mainImage').src = url;
    }
</script> 






 *@























@* @page "{id:int}"
@model SaillingLoc.Pages.BoatDetailsModel
@using Microsoft.AspNetCore.Identity
@using SaillingLoc.Models
@inject SignInManager<User> SignInManager

@{
    ViewData["Title"] = "Détails du bateau";
    Layout = "_Layout";
}

<div class="container mt-4">
    <h1>@Model.Boat.Name (@Model.Boat.Brand @Model.Boat.Model)</h1>

    <div class="row mt-4">
        <div class="col-md-6">

            <!-- Photo principale -->
            <img src="@Model.Boat.GetFirstPhotoUrl()" 
                 class="img-fluid rounded shadow"
                 alt="Photo du bateau" />

            <!-- Autres photos -->
            @if (Model.Boat.Photos != null && Model.Boat.Photos.Count > 1)
            {
                <div class="mt-3 d-flex flex-wrap">
                    @foreach (var photo in Model.Boat.Photos.Skip(1))
                    {
                        <img src="@photo.PhotoUrl"
                             class="img-thumbnail m-1"
                             style="width:120px;height:80px;object-fit:cover;" />
                    }
                </div>
            }
        </div>

        <div class="col-md-6">
            <h4>Informations</h4>
            <table class="table table-bordered">
                <tr><th>Marque</th><td>@Model.Boat.Brand</td></tr>
                <tr><th>Modèle</th><td>@Model.Boat.Model</td></tr>
                <tr><th>Longueur</th><td>@Model.Boat.Length m</td></tr>
                <tr><th>Type moteur</th><td>@Model.Boat.EngineType</td></tr>
                <tr><th>Capacité</th><td>@Model.Boat.MaxPassengers personnes</td></tr>
                <tr><th>Prix / jour</th>
                    <td>@Model.Boat.PricePerDay.ToString("0.00") €</td>
                </tr>
                <tr><th>Port</th><td>@Model.Boat.Port?.Name</td></tr>
                <tr><th>Catégorie</th><td>@Model.Boat.BoatType?.Name</td></tr>
            </table>

            <p>@Model.Boat.Description</p>
        </div>
    </div>

    <hr />

    <!-- Équipements -->
    <h3>Équipements</h3>

    <ul class="list-group col-md-6">
        @foreach (var eq in Model.Boat.Equipments)
        {
            <li class="list-group-item d-flex justify-content-between">
                @eq.EquipmentName

                @if (Model.CanEditEquipment)
                {
                    <form method="post" asp-page-handler="DeleteEquipment" class="m-0 p-0">
                        <input type="hidden" name="equipmentId" value="@eq.Id" />
                        <button class="btn btn-sm btn-danger">Supprimer</button>
                    </form>
                }
            </li>
        }
    </ul>

    @if (Model.CanEditEquipment)
    {
        <div class="mt-3 col-md-6">
            <form method="post" asp-page-handler="AddEquipment">
                <div class="input-group">
                    <input type="text" asp-for="NewEquipmentName" class="form-control" placeholder="Ajouter un équipement..." />
                    <button class="btn btn-primary">Ajouter</button>
                </div>
            </form>
        </div>
    }

    <hr />

    <!-- Coordonnées GPS -->
    <h4>Localisation du bateau</h4>
    <p>Latitude : @Model.Boat.Latitude</p>
    <p>Longitude : @Model.Boat.Longitude</p>

</div> *@
